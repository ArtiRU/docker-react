services:
  app:
    build: .
    volumes:
      - build-output:/app/dist
    command: |
      sh -c "
        npm run build && 
        cp -r /app/dist/* /output/ && 
        echo 'Files copied to volume:' && 
        ls -la /output/ && 
        tail -f /dev/null
      "

  nginx:
    image: nginx:alpine
    ports:
      - '80:80'
    volumes:
      - build-output:/usr/share/nginx/html
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - app

volumes:
  build-output: